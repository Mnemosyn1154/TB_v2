# DESIGN_SYSTEM.md — AlgoTrader KR 디자인 시스템

> 대시보드 UI의 디자인 원칙, 토큰, 컴포넌트, 페이지 구성, 전환 로드맵을 정의합니다.
> 레퍼런스: [prism-insight](https://github.com/dragon1086/prism-insight) (Next.js + Tailwind + shadcn/ui + Recharts)

---

## 1. 개요

### 1.1 현재 상태

| 항목 | 현재 |
|------|------|
| 프레임워크 | Streamlit (Python) |
| 차트 | Plotly (plotly_dark 테마) |
| 스타일링 | Streamlit 기본 + 일부 CSS hack |
| 반응형 | 제한적 (Streamlit 레이아웃 의존) |
| 테마 | 다크 모드 only |
| 페이지 | 5개 (사이드바 라디오 라우팅) |

### 1.2 목표 상태

| 항목 | 목표 |
|------|------|
| 프레임워크 | **Next.js 14+ (App Router)** |
| UI 라이브러리 | **shadcn/ui + Tailwind CSS** |
| 차트 | **Recharts** (React 네이티브) |
| 상태관리 | React useState + URL query params |
| 반응형 | 모바일/태블릿/데스크톱 완전 대응 |
| 테마 | 다크/라이트 모드 전환 |
| 페이지 | **6개 (탭 네비게이션)** |

### 1.3 전환 이유

- **반응형 UI**: Streamlit은 모바일 대응이 구조적으로 제한됨
- **컴포넌트 재사용**: shadcn/ui 기반으로 일관된 디자인 시스템 구축
- **성능**: CSR/SSR 혼합으로 초기 로딩 및 데이터 갱신 최적화
- **커스터마이징**: Tailwind 유틸리티로 정밀한 레이아웃 제어
- **디자인 품질**: prism-insight 수준의 그라데이션, 정보 계층화, 색상 체계 적용

---

## 2. 디자인 원칙

### 2.1 정보 계층화 (Information Hierarchy)

데이터를 4단계로 계층화하여 시선 흐름을 유도한다.

```
Level 1  큰 숫자 (KPI)          — 총자산 ₩52,340,000
Level 2  설명 텍스트             — "전일 대비 +2.3%"
Level 3  보조 정보 (색상 코딩)   — 녹색 = 수익, 빨강 = 손실
Level 4  툴팁/도움말             — ⓘ "Sharpe Ratio: 위험 대비 수익률"
```

### 2.2 색상 의미론 (Semantic Colors)

색상은 장식이 아니라 **의미를 전달**한다.

| 의미 | 색상 | 사용처 |
|------|------|--------|
| 수익/긍정 | 녹색 계열 | 양수 수익률, 성공 상태 |
| 손실/위험 | 빨강 계열 | 음수 수익률, Kill Switch, 에러 |
| 중립/보조 | 회색 계열 | 비활성, 설명 텍스트 |
| KR 시장 | 블루/인디고 | 국내 종목 관련 UI |
| US 시장 | 에메랄드/틸 | 해외 종목 관련 UI |
| 강조/액션 | 퍼플/바이올렛 | CTA 버튼, 활성 탭 |

### 2.3 워크플로우 기반 네비게이션

탭 순서가 사용자의 실제 워크플로우를 반영한다.

- **일상 모니터링** (탭 1~2): 열면 바로 상황 파악
- **전략 개발** (탭 3~5): 설정 → 검증 → 시뮬레이션 순차 흐름
- **운영** (탭 6): 실거래 실행과 긴급 제어

### 2.4 반응형 우선 (Mobile-First)

- 모바일: 1열 스택, 핵심 KPI만 표시
- 태블릿: 2열 그리드, 차트 축소
- 데스크톱: 3~5열 그리드, 모든 정보 표시

### 2.5 점진적 공개 (Progressive Disclosure)

- 첫 화면: 핵심 지표만 (총자산, 수익률, MDD)
- 스크롤/클릭: 상세 데이터 (전략별, 종목별)
- 모달/확장: 풀 분석 (거래 내역, AI 시나리오)

---

## 3. 디자인 토큰

### 3.1 색상 팔레트

prism-insight의 OKLCH 기반 팔레트를 참고하되, 우리 프로젝트에 맞게 조정한다.

#### 시맨틱 색상 (라이트/다크 모드)

```
토큰명              용도                    라이트          다크
──────────────────────────────────────────────────────────────
--background        페이지 배경             #ffffff         #0a0a0a
--foreground        기본 텍스트             #0a0a0a         #fafafa
--card              카드 배경               #ffffff         #0a0a0a
--card-foreground   카드 텍스트             #0a0a0a         #fafafa
--primary           주요 액션/강조          #1a1a2e         #fafafa
--secondary         보조 요소               #f5f5f5         #262626
--muted             비활성/보조 텍스트      #f5f5f5         #262626
--accent            호버/포커스             #f5f5f5         #262626
--destructive       에러/위험/손실          #ef4444         #dc2626
--success           성공/수익               #22c55e         #16a34a
--border            테두리                  #e5e5e5         #262626
--ring              포커스 링               #1a1a2e         #d4d4d4
```

#### 시장별 색상

```
토큰명              용도                    값
──────────────────────────────────────────────────────
--market-kr         KR 시장 프라이머리      #3b82f6  (blue-500)
--market-kr-bg      KR 시장 배경 그라데이션  from-blue-500/10 to-indigo-500/10
--market-us         US 시장 프라이머리      #10b981  (emerald-500)
--market-us-bg      US 시장 배경 그라데이션  from-emerald-500/10 to-teal-500/10
```

#### 차트 전용 색상

```
순서    색상      Hex         용도 예시
──────────────────────────────────────
1       블루      #3b82f6     KOSPI / 포트폴리오
2       에메랄드  #10b981     KOSDAQ / S&P500
3       퍼플      #a855f7     전략 A (StatArb)
4       오렌지    #f59e0b     전략 B (DualMomentum)
5       핑크      #ec4899     전략 C (QuantFactor)
6       틸        #14b8a6     보조 계열
7       레드      #ef4444     MDD / 드로다운
8       그레이    #6b7280     벤치마크 기준선
```

### 3.2 타이포그래피

```
요소              폰트              크기      굵기      용도
──────────────────────────────────────────────────────────────
KPI 숫자          Geist (sans)      2xl~3xl   bold      총자산, 수익률
섹션 제목         Geist (sans)      lg~xl     semibold  페이지/섹션 헤더
본문              Geist (sans)      sm~base   normal    설명, 레이블
보조 텍스트       Geist (sans)      xs~sm     normal    캡션, 타임스탬프
숫자/코드         Geist Mono        sm~base   medium    종목코드, 가격
```

### 3.3 간격 & 레이아웃

#### 반응형 Breakpoints

```
이름        최소 너비     그리드 열수     용도
──────────────────────────────────────────────
mobile      0px           1열             스마트폰
sm          640px         2열             큰 스마트폰
md          768px         2~3열           태블릿
lg          1024px        3~4열           작은 데스크톱
xl          1280px        4~6열           데스크톱
```

#### 간격 체계

```
토큰      값        용도
──────────────────────────────
gap-xs    4px       아이콘과 텍스트 사이
gap-sm    8px       카드 내부 요소 간격
gap-md    16px      카드 간 간격
gap-lg    24px      섹션 간 간격
gap-xl    32px      페이지 상단/하단 여백
```

### 3.4 모서리 반경

```
토큰          값          용도
──────────────────────────────────
--radius-sm   calc(0.75rem - 4px)   버튼, 입력 필드
--radius-md   calc(0.75rem - 2px)   카드 내부 요소
--radius-lg   0.75rem               카드, 모달
--radius-xl   calc(0.75rem + 4px)   큰 컨테이너
--radius-full 9999px                뱃지, 아바타
```

### 3.5 그림자 & 효과

```
요소              효과                              용도
──────────────────────────────────────────────────────────────
카드 기본         border border-border/50            기본 카드
카드 호버         shadow-md + scale(1.01)            인터랙티브 카드
활성 탭          bg-gradient + shadow-sm             현재 선택된 탭
헤더             backdrop-blur-md + sticky top-0     고정 헤더
모달 오버레이     bg-black/50 backdrop-blur-sm        모달 뒤 배경
```

---

## 4. 페이지 구성

### 4.1 전체 구조

```
┌─────────────────────────────────────────────────────────────┐
│  Dashboard Header                                           │
│  [로고] [① 자산현황] [② 벤치마크] [③ 전략설정]             │
│         [④ 백테스트] [⑤ 모의거래] [⑥ 실행&제어]            │
│  [마켓: KR|US]  [모드: 실거래|모의]  [테마: ☀|🌙]           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Tab Content Area                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 페이지별 레이아웃

---

#### ① 자산 현황 (기본 탭)

앱을 열면 가장 먼저 보이는 화면. 현재 자산 상태를 한눈에 파악한다.

```
┌─ KPI 카드 (3~4열 그리드) ──────────────────────────┐
│ [총자산]        [총수익률]       [현금비중]         │
│ ₩52,340,000    +12.3%          34.2%              │
│ 전일대비 +1.2%  시작 대비       목표: 30%          │
├─ 전략별 실적 ──────────────────────────────────────┤
│ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│ │ StatArb  │ │ Dual Mom │ │ Quant    │           │
│ │ +5.2%    │ │ -1.1%    │ │ 비활성   │           │
│ │ 3 포지션 │ │ 2 포지션 │ │          │           │
│ └──────────┘ └──────────┘ └──────────┘           │
├─ 보유 종목 테이블 ─────────────────────────────────┤
│ [KR 탭] [US 탭]                                    │
│ 종목명 | 수량 | 평균가 | 현재가 | 수익률 | 비중   │
│ ─────────────────────────────────────────────────  │
│ 삼성전자 | 10 | 72,000 | 74,500 | +3.5% | 14.2%  │
│ SK하이닉스| 5 | 180,000| 175,000| -2.8% | 8.9%   │
├─ 위험 지표 (하단 요약) ────────────────────────────┤
│ [MDD: -4.2%] [Sharpe: 1.34] [일일손익: +320,000]  │
│ [Kill Switch: OFF ●]                               │
└────────────────────────────────────────────────────┘
```

**데이터 소스**: KIS API (실시간 잔고 조회)
**갱신 주기**: 수동 새로고침 + 자동 5분 폴링
**현재 대응**: `p2_portfolio.py` + `portfolio_service.py`

---

#### ② 벤치마크 비교

내 포트폴리오가 시장 대비 어떤 성과를 내고 있는지 비교한다.

```
┌─ 기간 선택 ────────────────────────────────────────┐
│ [1M] [3M] [6M] [1Y] [전체] [커스텀 📅...📅]       │
├─ 수익률 비교 차트 (메인) ──────────────────────────┤
│                                                    │
│  ── 내 포트폴리오 (퍼플, 실선)                     │
│  ── KOSPI (블루, 점선)                             │
│  ── S&P500 (에메랄드, 점선)                        │
│                                        ▲           │
│  15% ─────────────────────── ───/──── │           │
│  10% ──────────────── ──/─── ────── ──│           │
│   5% ───────── ──/─── ───────────── ──│           │
│   0% ──/────── ──────────────────── ──│           │
│  -5% ─────────────────────────────── ─│           │
│       Jan    Mar    May    Jul    Sep  │           │
│                                                    │
├─ 초과수익 지표 (2~3열 카드) ───────────────────────┤
│ [Alpha]          [Beta]           [Info Ratio]     │
│ +3.2%            0.78             1.15             │
│ 시장 대비 초과   시장 대비 변동성  추적 오차 대비   │
├─ 전략별 벤치마크 대비 ─────────────────────────────┤
│ 전략        내 수익률   KOSPI    초과수익   판정    │
│ StatArb     +8.2%      +5.1%    +3.1%     ✅      │
│ DualMom     +2.1%      +5.1%    -3.0%     ⚠️      │
└────────────────────────────────────────────────────┘
```

**데이터 소스**: 포트폴리오 수익률 (DB/KIS) + 벤치마크 (yfinance)
**현재 대응**: 신규 페이지 (현재 없음)

---

#### ③ 전략 설정

전략 파라미터를 조정하고 종목 유니버스를 관리한다.

```
┌─ 전략 목록 ────────────────────────────────────────┐
│ ┌─ StatArb ──────────── [ON 🟢] ─────────────────┐│
│ │ Z-Score 진입: 2.0    청산: 0.5    손절: 3.0     ││
│ │ 룩백 기간: 60일      최소 상관: 0.7             ││
│ │ 페어: Samsung_Hynix, Naver_Kakao ...            ││
│ │                              [파라미터 편집 ✏️]  ││
│ └────────────────────────────────────────────────┘│
│ ┌─ DualMomentum ─────── [ON 🟢] ─────────────────┐│
│ │ 룩백: 252일   리밸런싱: 월 1회                  ││
│ │ KR ETF: KODEX200 / US ETF: SPY, QQQ            ││
│ │                              [파라미터 편집 ✏️]  ││
│ └────────────────────────────────────────────────┘│
│ ┌─ QuantFactor ──────── [OFF ⚫] ────────────────┐│
│ │ Value 30% / Quality 30% / Momentum 40%         ││
│ │ 유니버스: KOSPI200 상위 50종목                   ││
│ │                              [파라미터 편집 ✏️]  ││
│ └────────────────────────────────────────────────┘│
├─ settings.yaml 직접 편집 (고급) ───────────────────┤
│ [YAML 에디터 (접기/펴기)]                          │
└────────────────────────────────────────────────────┘
```

**데이터 소스**: `config/settings.yaml`
**현재 대응**: `p3_settings.py` + `config_service.py`

---

#### ④ 백테스트

설정한 전략을 과거 데이터로 검증한다.

```
┌─ 실행 설정 ────────────────────────────────────────┐
│ 전략: [StatArb ▾]  기간: [2020-01-01] ~ [2024-12] │
│ 자본금: [50,000,000]  데이터: [yfinance ▾]         │
│ □ 페어별 비교  □ CSV 내보내기     [▶ 백테스트 실행] │
├─ KPI 카드 (6열) ───────────────────────────────────┤
│ [수익률] [CAGR] [Sharpe] [MDD] [승률] [손익비]     │
│ +45.2%  +9.8%  1.34    -12.3%  62%   2.15         │
├─ 에퀴티 커브 ──────────────────────────────────────┤
│ (라인 차트 — 자산 추이 + fill 영역)                 │
├─ 보조 차트 (2열) ──────────────────────────────────┤
│ [드로다운 차트]          [손익 분포 히스토그램]      │
├─ 월별 히트맵 ──────────────────────────────────────┤
│ (RdYlGn 히트맵 — 월별 수익률 %)                    │
├─ 거래 내역 테이블 ─────────────────────────────────┤
│ 날짜 | 전략 | 종목 | 방향 | 가격 | 손익 | 수익률   │
└────────────────────────────────────────────────────┘
```

**데이터 소스**: yfinance / SQLite DB
**현재 대응**: `p1_backtest.py` + `backtest_service.py`

---

#### ⑤ 모의거래

실시간 데이터로 전략을 시뮬레이션한다. 실거래 전 최종 검증 단계.

```
┌─ 시그널 미리보기 ──────────────────────────────────┐
│ 현재 활성 전략의 시그널을 실시간 데이터로 생성      │
│                                                    │
│ [StatArb] Samsung_Hynix: Z=2.34 → BUY 삼성 / SELL │
│ [DualMom] KR > US 모멘텀 → KODEX200 매수 시그널    │
│                                                    │
│                    [▶ 모의 실행]  [시그널만 확인]    │
├─ 모의거래 결과 ────────────────────────────────────┤
│ 최근 모의거래 내역                                  │
│ 날짜 | 전략 | 종목 | 방향 | 가격 | 상태            │
│ 02/18 | StatArb | 005930 | BUY | 74,500 | 체결     │
├─ 누적 모의 성과 ───────────────────────────────────┤
│ (간단한 에퀴티 라인 + 승률/손익비 요약)              │
└────────────────────────────────────────────────────┘
```

**데이터 소스**: KIS API (모의투자 모드)
**현재 대응**: `p5_paper_trading.py` + `paper_trading_service.py`

---

#### ⑥ 실행 & 제어

실거래 운영과 긴급 제어를 담당한다.

```
┌─ 모드 & 상태 ──────────────────────────────────────┐
│ 거래 모드: [모의투자 🔵 | 실거래 🔴]               │
│ 마지막 실행: 2026-02-18 09:05:32                   │
│ 다음 스케줄: 2026-02-18 15:00:00                   │
├─ 실행 버튼 ────────────────────────────────────────┤
│ [▶ 전체 사이클 실행]  [📥 데이터 수집]              │
├─ Kill Switch ──────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐  │
│ │  🛑 Kill Switch                              │  │
│ │  모든 전략 실행을 즉시 중단합니다             │  │
│ │  현재: OFF                    [활성화 🔴]     │  │
│ └──────────────────────────────────────────────┘  │
├─ 전략 실행 상태 ───────────────────────────────────┤
│ StatArb:       마지막 실행 09:05 ✅ 정상            │
│ DualMomentum:  마지막 실행 09:05 ✅ 정상            │
│ QuantFactor:   비활성                               │
├─ 실행 로그 (실시간) ───────────────────────────────┤
│ 09:05:32 [INFO] 트레이딩 사이클 시작                │
│ 09:05:33 [INFO] StatArb: 2개 시그널 생성            │
│ 09:05:34 [INFO] 주문 실행: 005930 BUY 10주          │
│ 09:05:35 [INFO] 트레이딩 사이클 완료                │
│                                    [로그 지우기]    │
└────────────────────────────────────────────────────┘
```

**데이터 소스**: main.py CLI + KIS API + kill_switch.json
**현재 대응**: `p4_control.py` + `bot_service.py`

---

## 5. 컴포넌트 카탈로그

prism-insight에서 참고할 컴포넌트와 우리 프로젝트에 맞게 조정한 목록.

### 5.1 공통 컴포넌트

| 컴포넌트 | 역할 | prism-insight 참고 | 사용 페이지 |
|----------|------|-------------------|-------------|
| **DashboardHeader** | 탭 네비게이션 + 마켓 선택 + 모드 표시 + 테마 전환 | `dashboard-header.tsx` | 전체 |
| **MetricsCard** | KPI 카드 (아이콘 + 숫자 + 설명 + 변화량) | `metrics-cards.tsx` | ①②④ |
| **MarketSelector** | KR/US 시장 토글 버튼 | `market-selector.tsx` | ①② |
| **ThemeProvider** | 다크/라이트 모드 관리 | `theme-provider.tsx` | 전체 |

### 5.2 데이터 표시 컴포넌트

| 컴포넌트 | 역할 | prism-insight 참고 | 사용 페이지 |
|----------|------|-------------------|-------------|
| **HoldingsTable** | 보유 종목 테이블 (시장별 탭) | `holdings-table.tsx` | ① |
| **PerformanceChart** | 수익률 라인 차트 (다중 계열) | `performance-chart-new.tsx` | ②④ |
| **TradeHistoryList** | 거래 내역 (카드형 또는 테이블) | `trading-history-page.tsx` | ④⑤ |
| **StockDetailModal** | 종목 클릭 시 상세 정보 모달 | `stock-detail-modal.tsx` | ①② |

### 5.3 전략 관련 컴포넌트

| 컴포넌트 | 역할 | 신규 여부 | 사용 페이지 |
|----------|------|----------|-------------|
| **StrategyCard** | 전략별 상태 카드 (ON/OFF + 수익률 + 포지션 수) | 신규 | ①③ |
| **StrategyEditor** | 파라미터 편집 폼 | 신규 (현재 p3 기반) | ③ |
| **SignalPreview** | 시그널 미리보기 카드 | 신규 (현재 p5 기반) | ⑤ |
| **BacktestRunner** | 백테스트 실행 폼 + 결과 표시 | 신규 (현재 p1 기반) | ④ |

### 5.4 차트 컴포넌트

| 컴포넌트 | 차트 종류 | 라이브러리 | 사용 페이지 |
|----------|----------|-----------|-------------|
| **EquityCurve** | 라인 (fill 영역) | Recharts LineChart | ②④⑤ |
| **DrawdownChart** | 영역 차트 (음수) | Recharts AreaChart | ④ |
| **MonthlyHeatmap** | 히트맵 (RdYlGn) | Recharts 커스텀 | ④ |
| **PnLDistribution** | 히스토그램 | Recharts BarChart | ④ |
| **BenchmarkComparison** | 다중 라인 (점선 구분) | Recharts LineChart | ② |
| **PairComparison** | 그룹 바 차트 | Recharts BarChart | ④ |

### 5.5 컴포넌트 스타일 패턴

#### MetricsCard 스타일 (prism-insight 참고)

```
카드 구조:
┌─ Card (border-border/50) ──────────────────────┐
│ ┌─ 배경 그라데이션 (opacity-50) ──────────────┐│
│ │ [아이콘]  레이블                             ││
│ │           설명 텍스트 (muted)                ││
│ │                                              ││
│ │ ₩52,340,000          ▲ +1.2%                ││
│ │ (큰 숫자, bold)      (변화량, 색상 코딩)     ││
│ │                                              ││
│ │ 보조 정보 (xs, muted)                        ││
│ └──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘

시장별 그라데이션:
  KR → from-blue-500/10 to-indigo-500/10
  US → from-emerald-500/10 to-teal-500/10
```

---

## 6. 전환 로드맵

### Phase 1: 디자인 확정 (현재 단계)

- [x] prism-insight 분석 및 디자인 요소 추출
- [x] 6페이지 구성 확정
- [x] 디자인 토큰 정의
- [x] 컴포넌트 카탈로그 작성
- [ ] 페이지별 와이어프레임 상세화 (Figma 또는 마크다운)
- [ ] 데이터 흐름 정의 (각 컴포넌트가 필요한 데이터 스펙)

### Phase 2: 프로젝트 세팅

- [ ] Next.js 14+ 프로젝트 초기화 (`dashboard-next/`)
- [ ] Tailwind CSS + shadcn/ui 설치 및 테마 설정
- [ ] 디자인 토큰을 `globals.css`에 반영
- [ ] 기본 레이아웃 (Header + Tab + Content) 구현
- [ ] **백엔드 API 결정** (FastAPI vs JSON 파일 vs 기타)

### Phase 3: 컴포넌트 구현

- [ ] 공통 컴포넌트 (Header, MetricsCard, MarketSelector, ThemeProvider)
- [ ] 데이터 표시 컴포넌트 (HoldingsTable, PerformanceChart, TradeHistory)
- [ ] 차트 컴포넌트 (EquityCurve, BenchmarkComparison, MonthlyHeatmap)
- [ ] 전략 관련 컴포넌트 (StrategyCard, StrategyEditor)

### Phase 4: 페이지 마이그레이션

우선순위: 매일 보는 페이지부터

```
순서    페이지              난이도    의존성
────────────────────────────────────────────
1       ① 자산 현황         중       API 연동 필요
2       ② 벤치마크 비교     중       yfinance + 포트폴리오 데이터
3       ④ 백테스트          높       백테스트 엔진 API 래핑
4       ③ 전략 설정         낮       settings.yaml 읽기/쓰기
5       ⑤ 모의거래          중       KIS 모의투자 API
6       ⑥ 실행 & 제어       높       프로세스 관리 + 로그 스트리밍
```

### Phase 5: 데이터 연동 & 최적화

- [ ] Python 백엔드 ↔ Next.js 프론트 통신 확립
- [ ] 실시간 데이터 갱신 (폴링 또는 WebSocket)
- [ ] 에러 처리 및 로딩 상태 UI
- [ ] 성능 최적화 (코드 스플리팅, 캐싱)
- [ ] 모바일 테스트 및 반응형 검증

---

## 7. 참고 자료

| 자료 | 용도 |
|------|------|
| [prism-insight/examples/dashboard](https://github.com/dragon1086/prism-insight/tree/main/examples/dashboard) | 디자인 레퍼런스 (컴포넌트, 색상, 레이아웃) |
| [shadcn/ui](https://ui.shadcn.com/) | 기본 UI 컴포넌트 라이브러리 |
| [Tailwind CSS](https://tailwindcss.com/) | 유틸리티 CSS 프레임워크 |
| [Recharts](https://recharts.org/) | React 차트 라이브러리 |
| [Geist Font](https://vercel.com/font) | 타이포그래피 |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-18 | 초안 작성 — 6페이지 구성 확정, 디자인 토큰/컴포넌트 카탈로그/로드맵 정의 |
