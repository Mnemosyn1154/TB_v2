# UI_FEATURE_PLAN.md — D2trader UI 기능 도입 계획

> **상태: 히스토리 참조 전용** — 6탭 대시보드 모두 구현 완료 (2026-02-19).
> 아래 도입 판단과 보류/불필요 분류는 초기 설계 시점 기준이며, 실제 구현과 다를 수 있음.
>
> prism-insight 대시보드에서 어떤 기능/패턴을 가져올지, 왜 가져오는지, 왜 안 가져오는지를 정리합니다.
> 기술 스펙은 [`WEB_PROJECT_SPEC.md`](./WEB_PROJECT_SPEC.md), 디자인 토큰은 [`DESIGN_SYSTEM.md`](./DESIGN_SYSTEM.md) 참조.

---

## 1. 개요

### 1.1 목적

prism-insight의 대시보드(`examples/dashboard/`)는 18개 컴포넌트로 구성된 완성도 높은 트레이딩 대시보드이다.
이 문서는 각 기능을 **도입 / 변형 도입 / 보류 / 불필요**로 판단하고, 그 근거를 명시한다.

### 1.2 판단 기준

| 기준 | 설명 |
|------|------|
| **워크플로우 적합성** | 사용자의 일상 워크플로우(자산 확인 → 벤치마크 → 전략 개발 → 운영)에 맞는가 |
| **데이터 가용성** | 우리 백엔드(KIS API, 백테스트 엔진, settings.yaml)에서 데이터를 제공할 수 있는가 |
| **구현 복잡도** | 초기 버전에 포함할 만큼 간단한가, 아니면 후순위로 미룰 것인가 |
| **프로젝트 차이** | prism-insight(AI 에이전트 기반)과 D2trader(알고리즘 전략 기반)의 구조적 차이 |

---

## 2. 기능별 도입 판단표

### 범례

- ✅ **도입** — 그대로 또는 약간 변형하여 가져옴
- 🔄 **변형 도입** — 컨셉은 가져오되, 우리 프로젝트에 맞게 재설계
- ⏸️ **보류** — 가치는 있으나 초기 버전에서는 제외, 추후 검토
- ❌ **불필요** — 프로젝트 특성상 필요 없음

### 2.1 레이아웃 & 네비게이션

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| 탭 기반 네비게이션 (6탭) | ✅ 도입 | 우리도 6페이지 탭 구조 확정 |
| Sticky 헤더 + backdrop blur | ✅ 도입 | 스크롤 시 네비게이션 유지, UX 향상 |
| 마켓 선택기 (KR/US 토글) | ✅ 도입 | KR/US 잔고 분리 표시에 필수 |
| 스폰서 배너 | ❌ 불필요 | 개인 프로젝트, 스폰서 없음 |
| 반응형 모바일 네비게이션 | ✅ 도입 | 외출 중 핸드폰으로 자산 확인 필수 |

### 2.2 데이터 표시 컴포넌트

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| KPI 메트릭 카드 (그라데이션 + 아이콘) | ✅ 도입 | 현재 `st.metric()`보다 정보 계층화 우수 |
| 시장별 색상 구분 (KR=블루, US=에메랄드) | ✅ 도입 | 시각적 구분이 즉각적, 직관적 |
| 보유종목 테이블 (실전/시뮬 분리) | 🔄 변형 도입 | 실전/시뮬 대신 **KR/US 탭 분리**로 변형 |
| 종목 클릭 → 상세 모달 | ⏸️ 보류 | 유용하지만 초기 버전에서는 테이블만으로 충분 |
| 운영 비용 카드 (operating-costs) | ❌ 불필요 | API 비용 추적 불필요 (AI 에이전트 미사용) |

### 2.3 차트 & 시각화

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| 다중 계열 수익률 차트 (포트폴리오 vs 벤치마크) | ✅ 도입 | 벤치마크 비교 페이지의 핵심 |
| 동적 Y축 스케일링 (15% 패딩) | ✅ 도입 | 차트 가독성 향상, 간단한 구현 |
| 색상 코드 시스템 (KOSPI=블루, 전략=퍼플 등) | ✅ 도입 | 차트 5개 색상 체계 그대로 활용 |
| MDD 표시 (차트 내) | ✅ 도입 | 리스크 인지에 중요 |
| 시즌 필터링 (특정 날짜 이후만 표시) | 🔄 변형 도입 | 시즌 대신 **기간 선택기** (1M/3M/6M/1Y/ALL)로 변형 |

### 2.4 거래 분석

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| 통계 카드 (총 거래수, 승률, 평균 수익/손실) | ✅ 도입 | 백테스트 KPI 카드로 활용 |
| 위험 조정 지표 (Sharpe, Alpha, Beta, IR) | ✅ 도입 | 벤치마크 비교 페이지 + 자산 현황에 표시 |
| 손익비 (Profit Factor) | ✅ 도입 | 이미 백테스트에 있음, 실시간에도 추가 |
| 최대 연승/연패 계산 | ⏸️ 보류 | 유용하나 초기 우선순위 낮음 |
| 섹터별 성과 분석 | ❌ 불필요 | 우리는 섹터 기반이 아닌 전략 기반 분석 |
| 투자 기간별 성과 분류 | ⏸️ 보류 | 데이터 축적 후 의미 있음 |
| 거래 카드 (AI 근거, 시나리오 포함) | 🔄 변형 도입 | AI 근거 대신 **전략 시그널 근거** (Z-Score, 모멘텀 값) 표시 |

### 2.5 AI / 의사결정

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| AI Decisions 페이지 (보유 판단 시각화) | 🔄 변형 도입 | AI 판단 대신 **전략 시그널 현황** (Z-Score, 모멘텀 방향 등) |
| 신뢰도 게이지/배지 | ❌ 불필요 | AI 신뢰도 개념 없음 (알고리즘은 deterministic) |
| 트리거 신뢰도 카드 | ❌ 불필요 | AI 트리거 피드백 루프 미사용 |
| 포트폴리오 조정 권고 | ⏸️ 보류 | 향후 리밸런싱 시그널로 발전 가능 |

### 2.6 사용자 경험

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| 다크/라이트 모드 전환 | ✅ 도입 | 기본 UX, next-themes로 간단 구현 |
| 다국어 지원 (한/영/일) | ❌ 불필요 | 1인 사용, 한국어 단일 언어로 충분 |
| 마지막 업데이트 타임스탬프 | ✅ 도입 | 데이터 신선도 확인 필수 |
| 5분 자동 갱신 | ✅ 도입 | 자산 현황 자동 업데이트 |
| GitHub/Telegram 링크 버튼 | ❌ 불필요 | 개인 프로젝트, 외부 링크 불필요 |
| 로딩 스피너 (Suspense) | ✅ 도입 | API 호출 대기 시 필수 UX |

### 2.7 인사이트 & 저널

| prism-insight 기능 | 판단 | 근거 |
|-------------------|------|------|
| Trading Insights 페이지 (거래 지혜, 원칙) | ❌ 불필요 | AI 자기학습 기반, 우리는 알고리즘 파라미터로 관리 |
| 거래 저널 (판단 평가, 상황 분석) | ⏸️ 보류 | 수동 트레이딩 저널은 유용할 수 있으나 자동거래와 맞지 않음 |
| Jeoningu Lab | ❌ 불필요 | prism-insight 고유 기능 |
| Watchlist 페이지 | 🔄 변형 도입 | 종목 감시 대신 **종목 유니버스 관리** (전략 설정 페이지에 통합) |

---

## 3. 도입 기능 상세

### 3.1 KPI 메트릭 카드

**현재 (Streamlit)**
```
st.metric("총수익률", "+45.2%", delta="+45.2%")
→ 작은 텍스트, 그라데이션 없음, 아이콘 없음
```

**목표 (D2trader)**
```
┌─ Card (border-border/50, 그라데이션 배경) ─────┐
│  📈  총수익률                                   │
│      시작 자본 대비 누적                        │
│                                                 │
│  +45.2%                          ▲ +2.3%        │
│  (2xl, bold)                     (전일 대비)     │
└─────────────────────────────────────────────────┘
```

**prism-insight 참고**: `metrics-cards.tsx`
- 시장별 그라데이션 배경 (KR=blue/indigo, US=emerald/teal)
- lucide-react 아이콘 + 레이블 + 설명
- 큰 숫자 + 변화량 (색상 코딩)
- 3열 반응형 그리드

**D2trader 적용 방향**:
- 자산 현황: 4개 카드 (총자산, 수익률, 현금비중, MDD)
- 백테스트: 6개 카드 (수익률, CAGR, Sharpe, MDD, 승률, 손익비)
- 벤치마크: 3개 카드 (Alpha, Beta, Information Ratio)

---

### 3.2 시장별 색상 구분

**현재**: 색상 구분 없음. KR/US 데이터가 동일한 스타일로 표시됨.

**목표**: 모든 시장 관련 UI에서 일관된 색상 적용.

| 요소 | KR | US |
|------|-----|-----|
| 카드 배경 | `from-blue-500/10 to-indigo-500/10` | `from-emerald-500/10 to-teal-500/10` |
| 마켓 선택 버튼 | 파란색 활성 | 초록색 활성 |
| 차트 기본색 | `#3b82f6` (blue-500) | `#10b981` (emerald-500) |
| 테이블 헤더 | 블루 악센트 | 에메랄드 악센트 |

**prism-insight 참고**: `metrics-cards.tsx`, `holdings-table.tsx`, `market-selector.tsx`

**적용 범위**: ① 자산 현황, ② 벤치마크, ⑤ 모의거래

---

### 3.3 다중 계열 수익률 차트

**현재**: Plotly 단일 에퀴티 커브 (포트폴리오만 표시).

**목표**:
```
── 내 포트폴리오 (퍼플, 실선, 굵게)
── KOSPI (블루, 점선)
── S&P500 (에메랄드, 점선)
── StatArb (오렌지, 가는 실선)
── DualMomentum (핑크, 가는 실선)
```

**prism-insight 참고**: `performance-chart-new.tsx`
- Recharts `LineChart` + 다중 `Line` 컴포넌트
- 동적 Y축 스케일링 (min/max + 15% 패딩)
- 커스텀 Tooltip (날짜 + 모든 계열 값 표시)
- 점선 구분 (`strokeDasharray="5 5"`)

**D2trader 적용 방향**:
- 벤치마크 페이지: 포트폴리오 vs KOSPI vs S&P500 (3계열)
- 백테스트 페이지: 전략 에퀴티 커브 (1계열, fill 영역)
- 벤치마크 페이지에서 전략별 분리 표시 (선택적 토글)

---

### 3.4 보유종목 테이블 (KR/US 탭 분리)

**현재**: `st.dataframe()`으로 단순 표시. KR/US 구분은 `st.tabs()`로만.

**목표**:
```
[KR 🇰🇷] [US 🇺🇸]

종목명      수량   평균가     현재가     수익률    비중
───────────────────────────────────────────────────
삼성전자     10    72,000    74,500    +3.5% ▲   14.2%
SK하이닉스    5   180,000   175,000   -2.8% ▼    8.9%
```

**prism-insight 참고**: `holdings-table.tsx`
- 시장별 다른 컬럼 구성 (실전: 평균가/현재가/수익률, 시뮬: 목표가/손절가/보유일)
- 수익률 색상 코딩 (양수=녹색+▲, 음수=빨강+▼)
- 행 호버 시 뮤테드 배경
- 행 클릭 → 상세 정보 콜백

**D2trader 적용 방향**:
- KR 탭: 종목명, 수량, 평균가, 현재가(₩), 수익률, 포트폴리오 비중
- US 탭: 종목명, 수량, 평균가, 현재가($), 수익률, 포트폴리오 비중
- 수익률 색상 코딩 적용
- 행 클릭 상세 모달은 Phase 2에서 추가

---

### 3.5 위험 조정 지표 (실시간)

**현재**: 백테스트 결과에만 Sharpe/MDD 존재. 실시간 대시보드에는 없음.

**목표**: 자산 현황 + 벤치마크 페이지에 실시간 위험 지표 표시.

| 지표 | 계산 | 표시 위치 |
|------|------|----------|
| **Sharpe Ratio** | (연환산 수익률 - 무위험률) / 연환산 표준편차 | ① 자산 현황, ② 벤치마크 |
| **Sortino Ratio** | (연환산 수익률 - 무위험률) / 하방 표준편차 | ① 자산 현황 |
| **Alpha** | 포트폴리오 수익률 - 벤치마크 수익률 | ② 벤치마크 |
| **Beta** | Cov(포트폴리오, 시장) / Var(시장) | ② 벤치마크 |
| **Information Ratio** | 연환산 초과수익률 / 추적오차 | ② 벤치마크 |
| **MDD** | (현재 - 고점) / 고점 | ① 자산 현황 |

**prism-insight 참고**: `trading-history-page.tsx`
- KOSPI를 벤치마크로 사용
- 카드 + 툴팁(HelpCircle 아이콘)으로 지표 설명 제공
- 색상: Sharpe > 1 = 녹색, < 0 = 빨강

**D2trader 적용 방향**:
- 자산 현황 하단: MDD, Sharpe, Sortino (3개 카드)
- 벤치마크 페이지: Alpha, Beta, IR (3개 카드) + 전략별 비교 테이블
- 각 카드에 ⓘ 툴팁으로 지표 의미 설명 (초보자 친화)

---

### 3.6 전략 시그널 현황 (AI Decisions 변형)

**prism-insight 원본**: AI 에이전트의 보유 판단, 신뢰도 게이지, 기술적 트렌드 분석.

**D2trader 변형**: 알고리즘 전략의 현재 시그널 상태를 시각화.

```
┌─ StatArb ──────────────────────────────────────┐
│  Samsung_Hynix 페어                             │
│  Z-Score: 2.34  [━━━━━━━━━━━━━━━━━●──] 진입선  │
│  상태: 매수 시그널 활성                         │
│  근거: "Z-Score 2.34 > 진입 임계 2.0"           │
│  헤지비율: β = 1.23                             │
├─ DualMomentum ─────────────────────────────────┤
│  KR 모멘텀: +12.3% (12개월)                     │
│  US 모멘텀: +8.7% (12개월)                      │
│  판정: KR > US → KODEX200 매수                  │
│  절대 모멘텀: ✅ 양수 (투자 적격)               │
└────────────────────────────────────────────────┘
```

**표시 위치**: ⑤ 모의거래 페이지의 시그널 미리보기 섹션
**데이터 소스**: Python `/py/signals` (dry-run)

---

### 3.7 거래 내역 강화

**현재**: `st.dataframe()`으로 단순 테이블 (날짜, 종목, 방향, 가격, 손익).

**목표**: 거래별 카드 또는 확장 가능한 행으로 상세 정보 표시.

**기본 표시 (테이블 행)**:
```
날짜      전략     종목     방향   가격      손익      수익률
02/15    StatArb  005930   SELL   74,500   +25,000   +3.5%
```

**확장 시 (행 클릭 또는 아코디언)**:
```
시그널 근거: Z-Score 0.3 < 청산 임계 0.5
진입가: 72,000 → 청산가: 74,500
보유기간: 8일
수수료: ₩78
```

**prism-insight 참고**: `trading-history-page.tsx`
- 각 거래에 AI 투자 근거, 시나리오, 섹터 분석 포함
- 색상 구분된 박스로 시각 구조화
- 필터/정렬 기능

**D2trader 적용 방향**:
- 초기: 기본 테이블 (정렬 가능)
- Phase 2: 행 확장으로 시그널 근거 표시
- 백테스트 + 모의거래 + 실거래 모두 동일한 테이블 컴포넌트 재사용

---

### 3.8 기간 선택기

**prism-insight**: Season2 시작일(2025-09-29) 이후만 필터링하는 하드코딩 방식.

**D2trader**: 유연한 기간 선택 UI.

```
[1M] [3M] [6M] [1Y] [전체] [커스텀 📅...📅]
```

**적용 위치**:
- ② 벤치마크 비교: 비교 기간 선택
- ④ 백테스트: 백테스트 기간 (이미 있음, UI 개선)

**구현**: shadcn/ui `ToggleGroup` + `DatePicker`

---

### 3.9 다크/라이트 모드

**현재**: Streamlit 다크 모드 고정.

**목표**: 토글 스위치로 즉시 전환.

**prism-insight 참고**: `theme-provider.tsx`
- `next-themes` 사용
- 헤더에 Sun/Moon 아이콘 토글
- CSS 변수 기반 전환 (컴포넌트 수정 불필요)

**D2trader 적용**: DESIGN_SYSTEM.md의 라이트/다크 색상 토큰을 `globals.css`에 정의.
`next-themes`의 `ThemeProvider`로 감싸면 자동 전환.

---

### 3.10 자동 데이터 갱신

**prism-insight**: `setInterval` 5분마다 JSON 파일 재조회.

**D2trader 적용**:
- ① 자산 현황: 5분마다 `/api/portfolio` 자동 호출
- ② 벤치마크: 수동 새로고침 (시세 데이터는 실시간 불필요)
- ⑥ 실행 & 제어: 실행 상태 10초마다 폴링 (전략 실행 중일 때만)

**구현**: `hooks/use-interval.ts` 커스텀 훅

---

## 4. 보류 / 불필요 기능 상세

### 4.1 보류 기능 (향후 검토)

| 기능 | 보류 사유 | 재검토 시점 |
|------|----------|------------|
| **종목 상세 모달** | 초기에는 테이블만으로 충분 | Phase 3~4 이후 |
| **최대 연승/연패** | 데이터 축적 필요, 우선순위 낮음 | 실거래 3개월 이후 |
| **투자 기간별 성과** | 충분한 거래 이력 필요 | 실거래 6개월 이후 |
| **포트폴리오 조정 권고** | 리밸런싱 로직 미구현 | 리밸런싱 전략 추가 시 |
| **거래 저널** | 자동거래에서는 수동 저널 필요성 낮음 | 반자동 거래 모드 추가 시 |

### 4.2 불필요 기능 (도입 안 함)

| 기능 | 사유 |
|------|------|
| **AI 신뢰도 게이지/배지** | D2trader는 AI 에이전트가 아닌 알고리즘 기반. 알고리즘은 deterministic이므로 "신뢰도" 개념이 맞지 않음 |
| **트리거 신뢰도 카드** | AI 자기학습 피드백 루프 미사용 |
| **다국어 지원** | 1인 사용 프로젝트, 한국어 단일 |
| **스폰서 배너** | 개인 프로젝트 |
| **GitHub/Telegram 링크** | 대시보드 내부에서 외부 링크 불필요 |
| **운영 비용 카드** | AI API 비용 추적 대상 없음 |
| **섹터별 성과** | 전략 기반 분석이지 섹터 기반이 아님 |
| **Trading Insights** | AI 거래 지혜/원칙은 알고리즘 프로젝트에 해당 없음 |
| **Jeoningu Lab** | prism-insight 고유 기능 |

---

## 5. 페이지별 도입 기능 매핑

### ① 자산 현황

| 기능 | 출처 | 우선순위 |
|------|------|---------|
| KPI 카드 4개 (총자산, 수익률, 현금비중, MDD) | prism-insight `metrics-cards.tsx` | P0 |
| 전략별 실적 카드 (StatArb +5.2%, DualMom -1.1%) | 신규 (prism-insight 카드 패턴 활용) | P0 |
| 보유종목 테이블 (KR/US 탭) | prism-insight `holdings-table.tsx` 변형 | P0 |
| 위험 지표 (MDD, Sharpe, Sortino) | prism-insight `trading-history-page.tsx` | P1 |
| Kill Switch 상태 표시 | 신규 | P0 |
| 마지막 업데이트 타임스탬프 | prism-insight `dashboard-header.tsx` | P1 |
| 5분 자동 갱신 | prism-insight 패턴 | P1 |

### ② 벤치마크 비교

| 기능 | 출처 | 우선순위 |
|------|------|---------|
| 다중 계열 수익률 차트 | prism-insight `performance-chart-new.tsx` | P0 |
| 기간 선택기 (1M/3M/6M/1Y/ALL) | prism-insight 시즌 필터 변형 | P0 |
| Alpha/Beta/IR 카드 | prism-insight 위험 지표 | P0 |
| 전략별 벤치마크 대비 테이블 | 신규 | P1 |

### ③ 전략 설정

| 기능 | 출처 | 우선순위 |
|------|------|---------|
| 전략 ON/OFF 토글 카드 | 신규 (prism-insight 카드 패턴) | P0 |
| 파라미터 편집 폼 | 기존 `p3_settings.py` 재설계 | P0 |
| 종목 유니버스 시각화 | prism-insight Watchlist 변형 | P1 |

### ④ 백테스트

| 기능 | 출처 | 우선순위 |
|------|------|---------|
| KPI 카드 6개 | prism-insight `metrics-cards.tsx` 패턴 | P0 |
| 에퀴티 커브 (Recharts) | 기존 Plotly → Recharts 전환 | P0 |
| 드로다운 차트 | 기존 Plotly → Recharts 전환 | P0 |
| 월별 히트맵 | 기존 Plotly → Recharts 커스텀 | P1 |
| 손익 분포 히스토그램 | 기존 Plotly → Recharts 전환 | P1 |
| 거래 내역 테이블 (정렬 가능) | prism-insight 패턴 + 기존 로직 | P0 |

### ⑤ 모의거래

| 기능 | 출처 | 우선순위 |
|------|------|---------|
| 전략 시그널 현황 카드 | prism-insight AI Decisions 변형 | P0 |
| 세션 관리 (시작/종료) | 기존 `p5_paper_trading.py` | P0 |
| 모의거래 내역 테이블 | 기존 → Recharts 테이블 전환 | P0 |

### ⑥ 실행 & 제어

| 기능 | 출처 | 우선순위 |
|------|------|---------|
| 실거래/모의 모드 토글 | 신규 | P0 |
| Kill Switch UI (큰 빨간 버튼) | 신규 | P0 |
| 실행 상태 표시 | 신규 | P0 |
| 실시간 로그 뷰어 | 신규 | P1 |

---

## 6. 도입하지 않는 prism-insight 컴포넌트 매핑

참고용으로 prism-insight의 18개 컴포넌트와 D2trader 대응을 정리한다.

| prism-insight 컴포넌트 | D2trader 대응 | 비고 |
|----------------------|--------------|------|
| `dashboard-header.tsx` | ✅ `dashboard-header.tsx` | 탭 구성만 변경 |
| `metrics-cards.tsx` | ✅ `metrics-card.tsx` (공통) | 범용 카드 컴포넌트로 |
| `holdings-table.tsx` | ✅ `holdings-table.tsx` | KR/US 탭으로 변형 |
| `market-selector.tsx` | ✅ `market-selector.tsx` | 그대로 |
| `performance-chart-new.tsx` | ✅ `benchmark-chart.tsx` | 벤치마크 전용 |
| `performance-chart.tsx` | — | new 버전 사용 |
| `theme-provider.tsx` | ✅ next-themes 사용 | 동일 패턴 |
| `language-provider.tsx` | ❌ 미도입 | 단일 언어 |
| `project-footer.tsx` | ⏸️ 보류 | 최소한의 푸터만 |
| `stock-detail-modal.tsx` | ⏸️ 보류 | 추후 추가 |
| `trading-history-page.tsx` | 🔄 `trade-table.tsx` | 테이블 중심으로 간소화 |
| `ai-decisions-page.tsx` | 🔄 `signal-preview.tsx` | 전략 시그널로 변형 |
| `trading-insights-page.tsx` | ❌ 미도입 | AI 전용 |
| `watchlist-page.tsx` | 🔄 `universe-viewer.tsx` | 전략 설정에 통합 |
| `trigger-reliability-badge.tsx` | ❌ 미도입 | AI 전용 |
| `trigger-reliability-card.tsx` | ❌ 미도입 | AI 전용 |
| `operating-costs-card.tsx` | ❌ 미도입 | API 비용 불필요 |
| `jeoningu-lab-page.tsx` | ❌ 미도입 | prism 고유 |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-18 | 초안 작성 — 기능별 도입 판단, 상세 스펙, 페이지별 매핑 |
